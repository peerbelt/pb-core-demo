machine:
  node:
    version: 0.10.32
  python:
    version: 2.7.3
  services:
    - docker
dependencies:
  pre:
    - pip install awscli
#    - wget https://github.com/docker/machine/releases/download/v0.1.0-rc5/docker-machine_linux-amd64
#    - mv docker-machine_linux-amd64 docker-machine
#    - chmod 755 docker-machine
  override:
    - docker pull thedpd/console:latest
    - aws s3 cp s3://devops-peerbelt/ec2-keys/TEST/id_rsa_103 .
    - chmod 400 ./id_rsa_103
test:
  override:
    - docker run -d 44444:80 thedpd/console:latest; sleep 10;
    - curl --retry 10 --retry-delay 5 -v http://localhost:44444
deployment:
   incremental:
     branch: increment
       - ssh -i id_rsa_103 ubuntu@52.16.244.57 'sudo docker pull thedpd/console:latest'
       - ssh -i id_rsa_103 ubuntu@52.16.244.57 'sudo docker stop console1'
       - ssh -i id_rsa_103 ubuntu@52.16.244.57 'sudo docker rm -f console1'
       - ssh -i id_rsa_103 ubuntu@52.16.244.57 'sudo docker run -d -p 44444:80 --name console1 thedpd/console:latest; sleep 10'
       - ssh -i id_rsa_103 ubuntu@52.16.244.57 'sudo docker stop console_backups;sleep 10'
       - ssh -i id_rsa_103 ubuntu@52.16.244.57 'sudo docker rm -f console_backups;sleep 10'
       - ssh -i id_rsa_103 ubuntu@52.16.244.57 'sudo docker run -d -p 44445:80 --name console_backups thedpd/console:latest; sleep 10' 
